<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Express 4 への移行</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Express 4 への移行</h1>
</header>
<h1 id="express-4-への移行">Express 4 への移行</h1>
<h2 id="overview">
概説
</h2>
<p>Express 4 では、Express 3 とは互換性の <em>ない</em> 変更が行われています。つまり、依存関係にある Express のバージョンを更新すると、既存の Express 3 アプリケーションは機能しません。</p>
<p>この記事では以下の内容を扱います。</p>
<ul class="doclist">
<li>
<a href="#changes">Express 4 における変更点</a>
</li>
<li>
Express 3 アプリケーションを Express 4 に移行する<a href="#example-migration">例</a>
</li>
<li>
<a href="#app-gen">Express 4 アプリケーション・ジェネレーターへのアップグレード</a>
</li>
</ul>
<h2 id="changes">
Express 4 における変更点
</h2>
<p>Express 4 では、いくつかの大きな変更が行われています。</p>
<ul class="doclist">
<li>
<a href="#core-changes">Express コアおよびミドルウェア・システムの変更。</a>Connect と標準装備ミドルウェアに対する依存関係が削除されたため、ユーザーが自分でミドルウェアを追加する必要があります。
</li>
<li>
<a href="#routing">ルーティング・システムの変更。</a>
</li>
<li>
<a href="#other-changes">その他の各種変更。</a>
</li>
</ul>
<p>以下も参照してください。</p>
<ul>
<li><a href="https://github.com/expressjs/express/wiki/New-features-in-4.x">4.x の新機能</a></li>
<li><a href="https://github.com/expressjs/express/wiki/Migrating-from-3.x-to-4.x">3.x から 4.x への移行</a></li>
</ul>
<h3 id="core-changes">
Express コアおよびミドルウェア・システムの変更
</h3>
<p>Express 4 は、Connect に依存しなくなり、<code>express.static</code> 関数を除くすべての標準装備ミドルウェアをコアから削除しました。つまり、Express は独立したルーティングおよびミドルウェアの Web フレームワークになり、Express のバージョン管理とリリースはミドルウェア更新の影響を受けません。</p>
<p>標準装備ミドルウェアがないため、アプリケーションの実行に必要なすべてのミドルウェアを明示的に追加する必要があります。そのためには、単に以下のステップを実行してください。</p>
<ol type="1">
<li>モジュールをインストールします。<code>npm install --save &lt;module-name&gt;</code></li>
<li>アプリケーションでモジュールを要求します。<code>require('module-name')</code></li>
<li>モジュールの資料に従ってモジュールを使用します。<code>app.use( ... )</code></li>
</ol>
<p>次の表に、Express 3 のミドルウェアと、それぞれに対応する Express 4 のミドルウェアをリストします。</p>
<table class="doctable" border="1">
<tr>
<th>
Express 3
</th>
<th>
Express 4
</th>
</tr>
<tr>
<td>
<code>express.bodyParser</code>
</td>
<td>
<a href="https://github.com/expressjs/body-parser">body-parser</a> + <a href="https://github.com/expressjs/multer">multer</a>
</td>
</tr>
<tr>
<td>
<code>express.compress</code>
</td>
<td>
<a href="https://github.com/expressjs/compression">compression</a>
</td>
</tr>
<tr>
<td>
<code>express.cookieSession</code>
</td>
<td>
<a href="https://github.com/expressjs/cookie-session">cookie-session</a>
</td>
</tr>
<tr>
<td>
<code>express.cookieParser</code>
</td>
<td>
<a href="https://github.com/expressjs/cookie-parser">cookie-parser</a>
</td>
</tr>
<tr>
<td>
<code>express.logger</code>
</td>
<td>
<a href="https://github.com/expressjs/morgan">morgan</a>
</td>
</tr>
<tr>
<td>
<code>express.session</code>
</td>
<td>
<a href="https://github.com/expressjs/session">express-session</a>
</td>
</tr>
<tr>
<td>
<code>express.favicon</code>
</td>
<td>
<a href="https://github.com/expressjs/serve-favicon">serve-favicon</a>
</td>
</tr>
<tr>
<td>
<code>express.responseTime</code>
</td>
<td>
<a href="https://github.com/expressjs/response-time">response-time</a>
</td>
</tr>
<tr>
<td>
<code>express.errorHandler</code>
</td>
<td>
<a href="https://github.com/expressjs/errorhandler">errorhandler</a>
</td>
</tr>
<tr>
<td>
<code>express.methodOverride</code>
</td>
<td>
<a href="https://github.com/expressjs/method-override">method-override</a>
</td>
</tr>
<tr>
<td>
<code>express.timeout</code>
</td>
<td>
<a href="https://github.com/expressjs/timeout">connect-timeout</a>
</td>
</tr>
<tr>
<td>
<code>express.vhost</code>
</td>
<td>
<a href="https://github.com/expressjs/vhost">vhost</a>
</td>
</tr>
<tr>
<td>
<code>express.csrf</code>
</td>
<td>
<a href="https://github.com/expressjs/csurf">csurf</a>
</td>
</tr>
<tr>
<td>
<code>express.directory</code>
</td>
<td>
<a href="https://github.com/expressjs/serve-index">serve-index</a>
</td>
</tr>
<tr>
<td>
<code>express.static</code>
</td>
<td>
<a href="https://github.com/expressjs/serve-static">serve-static</a>
</td>
</tr>
</table>
<p>Express 4 のミドルウェアの完全なリストは、<a href="https://github.com/senchalabs/connect#middleware">ここ</a>を参照してください。</p>
<p>ほとんどの場合、旧バージョン 3 のミドルウェアを単に Express 4 のミドルウェアに置き換えるだけですみます。詳細については、GitHub でモジュールの資料を参照してください。</p>
<h4 id="app-use">
<code>app.use</code> がパラメーターを受け入れます
</h4>
<p>バージョン 4 では、変数パラメーターを使用して、ミドルウェア関数がロードされるパスを定義し、ルート・ハンドラーからパラメーターの値を読み取ることができます。 次に例を示します。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/book/:id&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;ID:&#39;</span><span class="op">,</span> <span class="va">req</span>.<span class="va">params</span>.<span class="at">id</span>)</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">}</span>)</a></code></pre></div>
<h3 id="routing">
ルーティング・システム
</h3>
<p>アプリケーションがルーティング・ミドルウェアを暗黙的にロードするようになったため、<code>router</code> ミドルウェアに関してミドルウェアがロードされる順序を考慮する必要がなくなりました。</p>
<p>ルートの定義方法は変わりませんが、ルーティング・システムには、ルートの編成に役立つ 2 つの新機能があります。</p>
<p>{: .doclist } * 新しいメソッド <code>app.route()</code> は、ルート・パスのチェーン可能なルート・ハンドラーを作成します。 * 新しいクラス <code>express.Router</code> は、モジュール式のマウント可能なルート・ハンドラーを作成します。</p>
<h4 id="app-route">
<code>app.route()</code> メソッド
</h4>
<p>新しい <code>app.route()</code> メソッドを使用すると、ルート・パスのチェーン可能なルート・ハンドラーを作成できます。パスは単一の場所で指定されるため、モジュール式のルートを作成すると、便利であるほか、冗長性とタイプミスを減らすことができます。ルートについて詳しくは、<a href="/%7B%7B%20page.lang%20%7D%7D/4x/api.html#router"><code>Router()</code> 資料</a>を参照してください。</p>
<p>次に、<code>app.route()</code> 関数を使用して定義された、チェーニングされたルート・ハンドラーの例を示します。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">app</span>.<span class="at">route</span>(<span class="st">&#39;/book&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">  .<span class="at">get</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Get a random book&#39;</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">  .<span class="at">post</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Add a book&#39;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">  .<span class="at">put</span>(<span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Update the book&#39;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="op">}</span>)</a></code></pre></div>
<h4 id="express-router">
<code>express.Router</code> クラス
</h4>
<p>ルートの編成に役立つもう 1 つの機能は、新しいクラス <code>express.Router</code> です。これを使用すると、モジュール式のマウント可能なルート・ハンドラーを作成できます。<code>Router</code> インスタンスは、完全なミドルウェアおよびルーティング・システムです。そのため、よく「ミニアプリケーション」と呼ばれます。</p>
<p>次の例では、ルーターをモジュールとして作成し、その中にミドルウェアをロードして、いくつかのルートを定義し、それをメインアプリケーションのパスにマウントします。</p>
<p>例えば、アプリケーション・ディレクトリーに次の内容で <code>birds.js</code> というルーター・ファイルを作成します。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> router <span class="op">=</span> <span class="va">express</span>.<span class="at">Router</span>()</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">// middleware specific to this router</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="va">router</span>.<span class="at">use</span>(<span class="kw">function</span> <span class="at">timeLog</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Time: &#39;</span><span class="op">,</span> <span class="va">Date</span>.<span class="at">now</span>())</a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb3-8" title="8"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">// define the home page route</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">router</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;Birds home page&#39;</span>)</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co">// define the about route</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="va">router</span>.<span class="at">get</span>(<span class="st">&#39;/about&#39;</span><span class="op">,</span> <span class="kw">function</span> (req<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="va">res</span>.<span class="at">send</span>(<span class="st">&#39;About birds&#39;</span>)</a>
<a class="sourceLine" id="cb3-16" title="16"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> router</a></code></pre></div>
<p>次に、ルーター・モジュールをアプリケーションにロードします。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">var</span> birds <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./birds&#39;</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">app</span>.<span class="at">use</span>(<span class="st">&#39;/birds&#39;</span><span class="op">,</span> birds)</a></code></pre></div>
<p>これで、アプリケーションは、<code>/birds</code> および <code>/birds/about</code> のパスに対する要求を処理できるようになり、ルートに固有の <code>timeLog</code> ミドルウェアを呼び出します。</p>
<h3 id="other-changes">
その他の変更点
</h3>
<p>次の表に、Express 4 におけるその他の小規模ながらも重要な変更点をリストします。</p>
<table class="doctable" border="1">
<tr>
<th>
オブジェクト
</th>
<th>
説明
</th>
</tr>
<tr>
<td>
Node.js
</td>
<td>
Express 4 には、Node.js 0.10.x 以降が必要です。Node.js 0.8.x に対するサポートは除去されました。
</td>
</tr>
<tr>
<td>
<code>http.createServer()</code>
</td>
<td>
<code>http</code> モジュールは、このモジュールを直接処理する必要がある場合を除き、不要になりました (socket.io/SPDY/HTTPS)。アプリケーションは、<code>app.listen()</code> 関数を使用して開始できます。
</td>
</tr>
<tr>
<td>
<code>app.configure()</code>
</td>
<td>
<code>app.configure()</code> 関数は削除されました。環境を検出して、アプリケーションを適宜に構成するには、<code>process.env.NODE_ENV</code> 関数または <code>app.get('env')</code> 関数を使用してください。
</td>
</tr>
<tr>
<td>
<code>json spaces</code>
</td>
<td>
<code>json spaces</code> アプリケーション・プロパティーは、Express 4 ではデフォルトで無効になっています。
</td>
</tr>
<tr>
<td>
<code>req.accepted()</code>
</td>
<td>
<code>req.accepts()</code>、<code>req.acceptsEncodings()</code>、<code>req.acceptsCharsets()</code>、および <code>req.acceptsLanguages()</code> を使用してください。
</td>
</tr>
<tr>
<td>
<code>res.location()</code>
</td>
<td>
相対 URL を解決しなくなりました。
</td>
</tr>
<tr>
<td>
<code>req.params</code>
</td>
<td>
以前は配列でしたが、現在ではオブジェクトになりました。
</td>
</tr>
<tr>
<td>
<code>res.locals</code>
</td>
<td>
以前は関数でしたが、現在ではオブジェクトになりました。
</td>
</tr>
<tr>
<td>
<code>res.headerSent</code>
</td>
<td>
<code>res.headersSent</code> に変更されました。
</td>
</tr>
<tr>
<td>
<code>app.route</code>
</td>
<td>
今後は <code>app.mountpath</code> として使用できます。
</td>
</tr>
<tr>
<td>
<code>res.on('header')</code>
</td>
<td>
削除されました。
</td>
</tr>
<tr>
<td>
<code>res.charset</code>
</td>
<td>
削除されました。
</td>
</tr>
<tr>
<td>
<code>res.setHeader('Set-Cookie', val)</code>
</td>
<td>
機能が基本的な Cookie 値の設定に限定されるようになりました。機能を追加するには、<code>res.cookie()</code> を使用してください。
</td>
</tr>
</table>
<h2 id="example-migration">
移行の例
</h2>
<p>次に、Express 3 アプリケーションを Express 4 に移行する例を示します。 使用しているファイルは、<code>app.js</code> および <code>package.json</code> です。</p>
<h3 id>
バージョン 3 アプリケーション
</h3>
<h4 id>
<code>app.js</code>
</h4>
<p>次の <code>app.js</code> ファイルを使用する Express v.3 アプリケーションがあるとします。</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> routes <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes&#39;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">var</span> user <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes/user&#39;</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">// all environments</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb5-11" title="11"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;views&#39;</span>))</a>
<a class="sourceLine" id="cb5-12" title="12"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</a>
<a class="sourceLine" id="cb5-13" title="13"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">favicon</span>())</a>
<a class="sourceLine" id="cb5-14" title="14"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">logger</span>(<span class="st">&#39;dev&#39;</span>))</a>
<a class="sourceLine" id="cb5-15" title="15"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">methodOverride</span>())</a>
<a class="sourceLine" id="cb5-16" title="16"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">session</span>(<span class="op">{</span> <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;your secret here&#39;</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb5-17" title="17"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">bodyParser</span>())</a>
<a class="sourceLine" id="cb5-18" title="18"><span class="va">app</span>.<span class="at">use</span>(<span class="va">app</span>.<span class="at">router</span>)</a>
<a class="sourceLine" id="cb5-19" title="19"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">static</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;public&#39;</span>)))</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">// development only</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="cf">if</span> (<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-23" title="23">  <span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">errorHandler</span>())</a>
<a class="sourceLine" id="cb5-24" title="24"><span class="op">}</span></a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="va">routes</span>.<span class="at">index</span>)</a>
<a class="sourceLine" id="cb5-27" title="27"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> <span class="va">user</span>.<span class="at">list</span>)</a>
<a class="sourceLine" id="cb5-28" title="28"></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="va">http</span>.<span class="at">createServer</span>(app).<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb5-30" title="30">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb5-31" title="31"><span class="op">}</span>)</a></code></pre></div>
<h4 id>
<code>package.json</code>
</h4>
<p>付随するバージョン 3 の <code>package.json</code> ファイルの内容は次のようになります。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;application-name&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">&quot;private&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;node app.js&quot;</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="dt">&quot;express&quot;</span><span class="fu">:</span> <span class="st">&quot;3.12.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="dt">&quot;pug&quot;</span><span class="fu">:</span> <span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="fu">}</span></a></code></pre></div>
<h3 id>
プロセス
</h3>
<p>移行プロセスを開始するには、次のコマンドを使用して、Express 4 アプリケーションに必要なミドルウェアをインストールし、Express と Pug をそれぞれの最新バージョンに更新します。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">npm</span> install serve-favicon morgan method-override express-session body-parser multer errorhandler express@latest pug@latest --save</a></code></pre></div>
<p><code>app.js</code> に以下の変更を加えます。</p>
<ol type="1">
<li><p>標準装備の Express ミドルウェア関数 <code>express.favicon</code>、<code>express.logger</code>、<code>express.methodOverride</code>、<code>express.session</code>、<code>express.bodyParser</code>、および <code>express.errorHandler</code> は <code>express</code> オブジェクトで使用できなくなりました。代わりの関数を手動でインストールして、アプリケーションにロードする必要があります。</p></li>
<li><p><code>app.router</code> 関数をロードする必要がなくなりました。この関数は有効な Express 4 アプリケーション・オブジェクトではないため、<code>app.use(app.router);</code> コードを削除してください。</p></li>
<li><p>ミドルウェア関数が正しい順序でロードされていることを確認してください。つまり、アプリケーション・ルートをロードした後で <code>errorHandler</code> をロードしてください。</p></li>
</ol>
<h3 id>
バージョン 4 アプリケーション
</h3>
<h4 id>
<code>package.json</code>
</h4>
<p>上記の <code>npm</code> コマンドを実行すると、<code>package.json</code> が次のように更新されます。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;application-name&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.0.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="dt">&quot;private&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="dt">&quot;scripts&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;node app.js&quot;</span></a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-9" title="9">    <span class="dt">&quot;body-parser&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.5.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-10" title="10">    <span class="dt">&quot;errorhandler&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.1.1&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="dt">&quot;express&quot;</span><span class="fu">:</span> <span class="st">&quot;^4.8.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="dt">&quot;express-session&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.7.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="dt">&quot;pug&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-14" title="14">    <span class="dt">&quot;method-override&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.1.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-15" title="15">    <span class="dt">&quot;morgan&quot;</span><span class="fu">:</span> <span class="st">&quot;^1.2.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-16" title="16">    <span class="dt">&quot;multer&quot;</span><span class="fu">:</span> <span class="st">&quot;^0.1.3&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-17" title="17">    <span class="dt">&quot;serve-favicon&quot;</span><span class="fu">:</span> <span class="st">&quot;^2.0.1&quot;</span></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="fu">}</span></a></code></pre></div>
<h4 id>
<code>app.js</code>
</h4>
<p>次に、無効なコードを削除して、必要なミドルウェアをロードし、必要に応じてその他の変更を行います。<code>app.js</code> ファイルの内容は次のようになります。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var</span> http <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;http&#39;</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">var</span> express <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express&#39;</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">var</span> routes <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes&#39;</span>)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">var</span> user <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;./routes/user&#39;</span>)</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">var</span> path <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;path&#39;</span>)</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">var</span> favicon <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;serve-favicon&#39;</span>)</a>
<a class="sourceLine" id="cb9-8" title="8"><span class="kw">var</span> logger <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;morgan&#39;</span>)</a>
<a class="sourceLine" id="cb9-9" title="9"><span class="kw">var</span> methodOverride <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;method-override&#39;</span>)</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">var</span> session <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;express-session&#39;</span>)</a>
<a class="sourceLine" id="cb9-11" title="11"><span class="kw">var</span> bodyParser <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;body-parser&#39;</span>)</a>
<a class="sourceLine" id="cb9-12" title="12"><span class="kw">var</span> multer <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;multer&#39;</span>)</a>
<a class="sourceLine" id="cb9-13" title="13"><span class="kw">var</span> errorHandler <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;errorhandler&#39;</span>)</a>
<a class="sourceLine" id="cb9-14" title="14"></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw">var</span> app <span class="op">=</span> <span class="at">express</span>()</a>
<a class="sourceLine" id="cb9-16" title="16"></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">// all environments</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb9-19" title="19"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;views&#39;</span><span class="op">,</span> <span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;views&#39;</span>))</a>
<a class="sourceLine" id="cb9-20" title="20"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;view engine&#39;</span><span class="op">,</span> <span class="st">&#39;pug&#39;</span>)</a>
<a class="sourceLine" id="cb9-21" title="21"><span class="va">app</span>.<span class="at">use</span>(<span class="at">favicon</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;/public/favicon.ico&#39;</span>)))</a>
<a class="sourceLine" id="cb9-22" title="22"><span class="va">app</span>.<span class="at">use</span>(<span class="at">logger</span>(<span class="st">&#39;dev&#39;</span>))</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="va">app</span>.<span class="at">use</span>(<span class="at">methodOverride</span>())</a>
<a class="sourceLine" id="cb9-24" title="24"><span class="va">app</span>.<span class="at">use</span>(<span class="at">session</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-25" title="25">  <span class="dt">resave</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-26" title="26">  <span class="dt">saveUninitialized</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-27" title="27">  <span class="dt">secret</span><span class="op">:</span> <span class="st">&#39;uwotm8&#39;</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="op">}</span>))</a>
<a class="sourceLine" id="cb9-29" title="29"><span class="va">app</span>.<span class="at">use</span>(<span class="va">bodyParser</span>.<span class="at">json</span>())</a>
<a class="sourceLine" id="cb9-30" title="30"><span class="va">app</span>.<span class="at">use</span>(<span class="va">bodyParser</span>.<span class="at">urlencoded</span>(<span class="op">{</span> <span class="dt">extended</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb9-31" title="31"><span class="va">app</span>.<span class="at">use</span>(<span class="at">multer</span>())</a>
<a class="sourceLine" id="cb9-32" title="32"><span class="va">app</span>.<span class="at">use</span>(<span class="va">express</span>.<span class="at">static</span>(<span class="va">path</span>.<span class="at">join</span>(__dirname<span class="op">,</span> <span class="st">&#39;public&#39;</span>)))</a>
<a class="sourceLine" id="cb9-33" title="33"></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/&#39;</span><span class="op">,</span> <span class="va">routes</span>.<span class="at">index</span>)</a>
<a class="sourceLine" id="cb9-35" title="35"><span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;/users&#39;</span><span class="op">,</span> <span class="va">user</span>.<span class="at">list</span>)</a>
<a class="sourceLine" id="cb9-36" title="36"></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">// error handling middleware should be loaded after the loading the routes</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="cf">if</span> (<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;env&#39;</span>) <span class="op">===</span> <span class="st">&#39;development&#39;</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb9-39" title="39">  <span class="va">app</span>.<span class="at">use</span>(<span class="at">errorHandler</span>())</a>
<a class="sourceLine" id="cb9-40" title="40"><span class="op">}</span></a>
<a class="sourceLine" id="cb9-41" title="41"></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="kw">var</span> server <span class="op">=</span> <span class="va">http</span>.<span class="at">createServer</span>(app)</a>
<a class="sourceLine" id="cb9-43" title="43"><span class="va">server</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb9-44" title="44">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb9-45" title="45"><span class="op">}</span>)</a></code></pre></div>
<div class="doc-box doc-info" markdown="1">

<p><code>http</code> モジュール (socket.io/SPDY/HTTPS) を直接処理する必要がある場合を除き、このモジュールをロードする必要はありません。次のようにして、アプリケーションを簡単に開始できます。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="va">app</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>))</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="op">}</span>)</a></code></pre></div>
<h3 id>
アプリケーションの実行
</h3>
<p>これで移行プロセスは完了して、アプリケーションは Express 4 アプリケーションになりました。確認するには、次のコマンドを使用してアプリケーションを開始します。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1">$ <span class="ex">node</span> .</a></code></pre></div>
<p><a href="http://localhost:3000">http://localhost:3000</a> をロードして、Express 4 によってレンダリングされるホーム・ページを確認します。</p>
<h2 id="app-gen">
Express 4 アプリケーション・ジェネレーターへのアップグレード
</h2>
<p>Express アプリケーションを生成するためのコマンド・ライン・ツールは引き続き <code>express</code> ですが、新規バージョンにアップグレードするには、Express 3 アプリケーション・ジェネレーターをアンインストールしてから、新しい <code>express-generator</code> をインストールする必要があります。</p>
<h3 id>
インストール
</h3>
<p>システムに Express 3 アプリケーション・ジェネレーターがインストールされている場合は、次のようにしてアンインストールする必要があります。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1">$ <span class="ex">npm</span> uninstall -g express</a></code></pre></div>
<p>ファイルおよびディレクトリーの特権が構成されている方法によっては、このコマンドを <code>sudo</code> で実行することが必要になる場合があります。</p>
<p>次に、新しいジェネレーターをインストールします。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">$ <span class="ex">npm</span> install -g express-generator</a></code></pre></div>
<p>ファイルおよびディレクトリーの特権が構成されている方法によっては、このコマンドを <code>sudo</code> で実行することが必要になる場合があります。</p>
<p>これで、システム上の <code>express</code> コマンドは Express 4 ジェネレーターに更新されました。</p>
<h3 id>
アプリケーション・ジェネレーターの変更
</h3>
<p>コマンドのオプションと使用法の大部分は以前と同じですが、以下の例外があります。</p>
<p>{: .doclist } * <code>--sessions</code> オプションを削除しました。 * <code>--jshtml</code> オプションを削除しました。 * <a href="http://twitter.github.io/hogan.js/">Hogan.js</a> をサポートするために <code>--hogan</code> オプションを追加しました。</p>
<h3 id>
例
</h3>
<p>次のコマンドを実行して、Express 4 アプリケーションを作成します。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">$ <span class="ex">express</span> app4</a></code></pre></div>
<p><code>app4/app.js</code> ファイルの内容を見ると、アプリケーションに必要な (<code>express.static</code> を除く) すべてのミドルウェア関数が独立したモジュールとしてロードされており、<code>router</code> ミドルウェアがアプリケーションに明示的にロードされなくなったことが分かります。</p>
<p>また、<code>app.js</code> ファイルが Node.js モジュールになったことも分かります。対照的に以前はジェネレーターによって生成されるスタンドアロン・モジュールでした。</p>
<p>依存関係をインストールした後、次のコマンドを使用してアプリケーションを開始します。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1">$ <span class="ex">npm</span> start</a></code></pre></div>
<p><code>package.json</code> ファイルで npm start スクリプトを見ると、アプリケーションを開始する実際のコマンドは <code>node ./bin/www</code> であることが分かります。これは、Express 3 では <code>node app.js</code> でした。</p>
<p>Express 4 ジェネレーターによって生成される <code>app.js</code> ファイルが Node.js モジュールになったため、(コードを変更しない限り) アプリケーションとして単独では開始できなくなりました。モジュールを Node.js ファイルにロードして、Node.js ファイルから開始する必要があります。この場合、Node.js ファイルは <code>./bin/www</code> です。</p>
<p>Express アプリケーションの作成またはアプリケーションの開始のために、<code>bin</code> ディレクトリーも、拡張子のない <code>www</code> ファイルも必須ではありません。これらは単にジェネレーターが推奨するものであるため、ニーズに合わせて自由に変更してください。</p>
<p><code>www</code> ディレクトリーを削除して、処理を「Express 3 の方法」で実行するには、<code>app.js</code> ファイルの最後にある <code>module.exports = app;</code> という行を削除して、その場所に以下のコードを貼り付けます。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">app</span>.<span class="at">set</span>(<span class="st">&#39;port&#39;</span><span class="op">,</span> <span class="va">process</span>.<span class="va">env</span>.<span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">var</span> server <span class="op">=</span> <span class="va">app</span>.<span class="at">listen</span>(<span class="va">app</span>.<span class="at">get</span>(<span class="st">&#39;port&#39;</span>)<span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="at">debug</span>(<span class="st">&#39;Express server listening on port &#39;</span> <span class="op">+</span> <span class="va">server</span>.<span class="at">address</span>().<span class="at">port</span>)</a>
<a class="sourceLine" id="cb16-5" title="5"><span class="op">}</span>)</a></code></pre></div>
<p>次のコードを使用して <code>debug</code> モジュールを <code>app.js</code> ファイルの先頭にロードしたことを確認します。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">var</span> debug <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;debug&#39;</span>)(<span class="st">&#39;app4&#39;</span>)</a></code></pre></div>
<p>次に、<code>package.json</code> ファイル内の <code>"start": "node ./bin/www"</code> を <code>"start": "node app.js"</code> に変更します。</p>
<p>これで、<code>./bin/www</code> の機能を <code>app.js</code> に戻しました。この変更は推奨されるものではありませんが、この演習により、<code>./bin/www</code> ファイルの仕組みと、<code>app.js</code> ファイルが単独で開始されなくなった理由を理解できます。</p>
</body>
</html>
