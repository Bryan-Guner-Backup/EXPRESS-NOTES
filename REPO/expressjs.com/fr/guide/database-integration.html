<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Express database integration</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Express database integration</h1>
    </header>
    <h1 id="intégration-de-bases-de-données">
      Intégration de bases de données
    </h1>
    <p>
      L’ajout de la fonctionnalité permettant de connecter des bases de données
      aux applications Express consiste simplement à charger un pilote Node.js
      approprié pour les bases de données de votre application. Ce document
      explique brièvement comment ajouter et utiliser dans votre application
      Express certains des modules Node.js les plus populaires pour les systèmes
      de base de données :
    </p>
    <ul>
      <li><a href="#cassandra">Cassandra</a></li>
      <li><a href="#couchdb">CouchDB</a></li>
      <li><a href="#leveldb">LevelDB</a></li>
      <li><a href="#mysql">MySQL</a></li>
      <li><a href="#mongo">MongoDB</a></li>
      <li><a href="#neo4j">Neo4j</a></li>
      <li><a href="#oracle">Oracle</a></li>
      <li><a href="#postgres">PostgreSQL</a></li>
      <li><a href="#redis">Redis</a></li>
      <li><a href="#sqlite">SQLite</a></li>
      <li><a href="#elasticsearch">ElasticSearch</a></li>
    </ul>
    <div class="doc-box doc-notice" data-markdown="1">
      <p>
        Ces pilotes de base de données ne sont qu’une partie de ceux
        disponibles. Pour d’autres options, consultez le site
        <a href="https://www.npmjs.com/">npm</a>.
      </p>
    </div>
    <p><a name="cassandra"></a></p>
    <h2 id="cassandra">Cassandra</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/datastax/nodejs-driver">cassandra-driver</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install cassandra-driver
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var cassandra = require('cassandra-driver');
var client = new cassandra.Client({ contactPoints: ['localhost']});

client.execute('select key from system.local', function(err, result) {
  if (err) throw err;
  console.log(result.rows[0]);
});
</code>
</pre>
    <p><a name="couchdb"></a></p>
    <h2 id="couchdb">CouchDB</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/dscape/nano">nano</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install nano
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var nano = require('nano')('http://localhost:5984');
nano.db.create('books');
var books = nano.db.use('books');

//Insert a book document in the books database
books.insert({name: 'The Art of war'}, null, function(err, body) {
  if (!err){
    console.log(body);
  }
});

//Get a list of all books
books.list(function(err, body){
  console.log(body.rows);
});
</code>
</pre>
    <p><a name="leveldb"></a></p>
    <h2 id="leveldb">LevelDB</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/rvagg/node-levelup">levelup</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install level levelup leveldown
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var levelup = require('levelup');
var db = levelup('./mydb');

db.put('name', 'LevelUP', function (err) {

  if (err) return console.log('Ooops!', err);
  db.get('name', function (err, value) {
    if (err) return console.log('Ooops!', err);
    console.log('name=' + value);
  });

});
</code>
</pre>
    <p><a name="mysql"></a></p>
    <h2 id="mysql">MySQL</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/felixge/node-mysql/">mysql</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install mysql
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var mysql      = require('mysql');
var connection = mysql.createConnection({
  host     : 'localhost',
  user     : 'dbuser',
  password : 's3kreee7'
});

connection.connect();

connection.query('SELECT 1 + 1 AS solution', function(err, rows, fields) {
  if (err) throw err;
  console.log('The solution is: ', rows[0].solution);
});

connection.end();
</code>
</pre>
    <p><a name="mongo"></a></p>
    <h2 id="mongodb">MongoDB</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/mongodb/node-mongodb-native">mongodb</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install mongodb
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var MongoClient = require('mongodb').MongoClient;

MongoClient.connect('mongodb://localhost:27017/animals', function(err, db) {
  if (err) {
    throw err;
  }
  db.collection('mammals').find().toArray(function(err, result) {
    if (err) {
      throw err;
    }
    console.log(result);
  });
});
</code>
</pre>
    <p>
      Si vous voulez un pilote de modèle d’objet pour MongoDB, recherchez
      <a href="https://github.com/LearnBoost/mongoose">Mongoose</a>.
    </p>
    <p><a name="neo4j"></a></p>
    <h2 id="neo4j">Neo4j</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/hacksparrow/apoc">apoc</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install apoc
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var apoc = require('apoc');

apoc.query('match (n) return n').exec().then(
  function (response) {
    console.log(response);
  },
  function (fail) {
    console.log(fail);
  }
);
</code>
</pre>
    <p><a name="oracle"></a></p>
    <h2 id="oracle">Oracle</h2>
    <p>
      <strong>Module</strong>:
      <a href="https://github.com/oracle/node-oracledb">oracledb</a>
    </p>
    <h3 id="installation">Installation</h3>
    <p>
      Remarque:
      <a href="https://github.com/oracle/node-oracledb#-installation"
        >Voir les conditions préalables à l’installation</a
      >.
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode sh"
      ><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="ex">npm</span> install oracledb</a></code></pre>
    </div>
    <h3 id="exemple">Exemple</h3>
    <div class="sourceCode" id="cb2">
      <pre
        class="sourceCode js"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> oracledb <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;oracledb&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> config <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">user</span><span class="op">:</span> <span class="st">&#39;&lt;your db user&gt;&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="dt">password</span><span class="op">:</span> <span class="st">&#39;&lt;your db password&gt;&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="dt">connectString</span><span class="op">:</span> <span class="st">&#39;localhost:1521/orcl&#39;</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">async</span> <span class="kw">function</span> <span class="at">getEmployee</span> (empId) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="kw">let</span> conn</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-12" title="12">    conn <span class="op">=</span> <span class="cf">await</span> <span class="va">oracledb</span>.<span class="at">getConnection</span>(config)</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="va">conn</span>.<span class="at">execute</span>(</a>
<a class="sourceLine" id="cb2-15" title="15">      <span class="st">&#39;select * from employees where employee_id = :id&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-16" title="16">      [empId]</a>
<a class="sourceLine" id="cb2-17" title="17">    )</a>
<a class="sourceLine" id="cb2-18" title="18"></a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="va">console</span>.<span class="at">log</span>(<span class="va">result</span>.<span class="at">rows</span>[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb2-20" title="20">  <span class="op">}</span> <span class="cf">catch</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Ouch!&#39;</span><span class="op">,</span> err)</a>
<a class="sourceLine" id="cb2-22" title="22">  <span class="op">}</span> <span class="cf">finally</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-23" title="23">    <span class="cf">if</span> (conn) <span class="op">{</span> <span class="co">// conn assignment worked, need to close</span></a>
<a class="sourceLine" id="cb2-24" title="24">      <span class="cf">await</span> <span class="va">conn</span>.<span class="at">close</span>()</a>
<a class="sourceLine" id="cb2-25" title="25">    <span class="op">}</span></a>
<a class="sourceLine" id="cb2-26" title="26">  <span class="op">}</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="op">}</span></a>
<a class="sourceLine" id="cb2-28" title="28"></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="at">getEmployee</span>(<span class="dv">101</span>)</a></code></pre>
    </div>
    <p><a name="postgres"></a></p>
    <h2 id="postgresql">PostgreSQL</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/vitaly-t/pg-promise">pg-promise</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install pg-promise
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var pgp = require("pg-promise")(/*options*/);
var db = pgp("postgres://username:password@host:port/database");

db.one("SELECT $1 AS value", 123)
    .then(function (data) {
        console.log("DATA:", data.value);
    })
    .catch(function (error) {
        console.log("ERROR:", error);
    });
</code>
</pre>
    <p><a name="redis"></a></p>
    <h2 id="redis">Redis</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/mranney/node_redis">redis</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install redis
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var client = require('redis').createClient();

client.on('error', function (err) {
  console.log('Error ' + err);
});

client.set('string key', 'string val', redis.print);
client.hset('hash key', 'hashtest 1', 'some value', redis.print);
client.hset(['hash key', 'hashtest 2', 'some other value'], redis.print);

client.hkeys('hash key', function (err, replies) {

  console.log(replies.length + ' replies:');
  replies.forEach(function (reply, i) {
    console.log('    ' + i + ': ' + reply);
  });

  client.quit();

});
</code>
</pre>
    <p><a name="sqlite"></a></p>
    <h2 id="sqlite">SQLite</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/mapbox/node-sqlite3">sqlite3</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install sqlite3
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var sqlite3 = require('sqlite3').verbose();
var db = new sqlite3.Database(':memory:');

db.serialize(function() {

  db.run('CREATE TABLE lorem (info TEXT)');
  var stmt = db.prepare('INSERT INTO lorem VALUES (?)');

  for (var i = 0; i < 10; i++) {
    stmt.run('Ipsum ' + i);
  }

  stmt.finalize();

  db.each('SELECT rowid AS id, info FROM lorem', function(err, row) {
    console.log(row.id + ': ' + row.info);
  });
});

db.close();
</code>
</pre>
    <p><a name="elasticsearch"></a></p>
    <h2 id="elasticsearch">ElasticSearch</h2>
    <p>
      <strong>Module</strong> :
      <a href="https://github.com/elastic/elasticsearch-js">elasticsearch</a>
      <strong>Installation</strong>
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install elasticsearch
</code>
</pre>
    <p><strong>Exemple</strong></p>
    <pre>
<code class="language-javascript" translate="no">
var elasticsearch = require('elasticsearch');
var client = elasticsearch.Client({
  host: 'localhost:9200'
});

client.search({
  index: 'books',
  type: 'book',
  body: {
    query: {
      multi_match: {
        query: 'express js',
        fields: ['title', 'description']
      }
    }
  }
}).then(function(response) {
  var hits = response.hits.hits;
}, function(error) {
  console.trace(error.message);
});
</code>
</pre>
  </body>
</html>
