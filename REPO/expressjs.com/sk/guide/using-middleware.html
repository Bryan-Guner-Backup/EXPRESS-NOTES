<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="sk" xml:lang="sk">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>Použitie Express middleware</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
  </head>
  <body>
    <header id="title-block-header">
      <h1 class="title">Použitie Express middleware</h1>
    </header>
    <!---
 Copyright (c) 2016 StrongLoop, IBM, and Express Contributors
 License: MIT
-->
    <h1 id="použitie-middleware">Použitie middleware</h1>
    <p>
      Express je webový framework s minimálnou vlastnou funkcionalitou: Express
      aplikácia je v podstate séria volaní middleware funkcií.
    </p>
    <p>
      <em>Middleware</em> funkcie sú funkcie, ktoré majú prístup k
      <a href="/4x/api.html#req">request objektu</a> (<code>req</code>),
      <a href="/4x/api.html#res">response objektu</a> (<code>res</code>) a
      nasledujúcej middleware funkcii v request-response cykle aplikácie.
      Nasledujúca middleware funkcia v poradí je bežne označovaná premennou
      <code>next</code>.
    </p>
    <p>Middleware funkcie dokážu vykonávať nasledujúce úlohy:</p>
    <ul>
      <li>Vykonať akýkoľvek kód.</li>
      <li>Vykonať zmeny na request a response objektoch.</li>
      <li>Ukončiť request-response cyklus.</li>
      <li>Zavolať nasledujúcu middleware funkciu v poradí.</li>
    </ul>
    <p>
      Ak aktuálna middleware funkcia neukončuje request-response cyklus, musí
      posunúť obsluhu nasledujúcej middleware funkcii vyvolaním
      <code>next()</code>. V opačnom prípade zostane request ‘visieť’.
    </p>
    <p>Express aplikácia môže použiť nasledovné typy middleware funkcií:</p>
    <ul>
      <li>
        <a href="#middleware.application">Application-level middleware</a>
      </li>
      <li><a href="#middleware.router">Router-level middleware</a></li>
      <li>
        <a href="#middleware.error-handling">Error-handling middleware</a>
      </li>
      <li><a href="#middleware.built-in">Built-in middleware</a></li>
      <li><a href="#middleware.third-party">Third-party middleware</a></li>
    </ul>
    <p>
      Application-level a router-level middleware môžete načítať s voliteľnou
      cestou (path-om). Môžete taktiež načítať skupinu middleware funkcií
      dohromady, čím vytvoríte sub-stack middleware systém na danej ceste.
    </p>
    <h2 id="middleware.application">Application-level middleware</h2>
    <p>
      Pripojte application-level middleware k inštancii
      <a href="/%7B%7B%20page.lang%20%7D%7D/4x/api.html#app">app objektu</a>
      použitím <code>app.use()</code> a <code>app.METHOD()</code> funkcií, kde
      <code>METHOD</code> je typicky HTTP metóda requestu, ktorý mddleware
      funkcia handluje (ako napr. GET, PUT, či POST) zapísaná v lowercase
      formáte.
    </p>
    <p>
      Nasledujúci príklad ukazuje middleware funkciu, ktorá nie je pripojená na
      žiaden path. Funkcia bude vykonaná vždy, keď aplikácia obdrží request.
    </p>
    <pre>
<code class="language-javascript" translate="no">
var app = express();

app.use(function (req, res, next) {
  console.log('Time:', Date.now());
  next();
});
</code>
</pre>
    <p>
      Nasledujúci príklad ukazuje middleware funkciu pripojenú na ceste
      <code>/user/:id</code>. Funkcia bude vykonaná vždy, keď aplikácia održí
      request na <code>/user/:id</code> a to bez ohľadu na typ použitej HTTP
      metódy.
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.use('/user/:id', function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});
</code>
</pre>
    <p>
      Nasledujúci príklad ukazuje route a jej handler funkciu (middleware
      systém). Táto funkcia handluje GET requesty na ceste
      <code>/user/:id</code>.
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  res.send('USER');
});
</code>
</pre>
    <p>
      Tu je príklad načítania skupiny middleware funkcií pripojených na
      konkrétnu cesty. Príklad ilustruje sub-stack middleware, ktorý vypíše info
      o requeste pre všetky typy HTTP requestov vykonaných na
      <code>/user/:id</code>.
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.use('/user/:id', function(req, res, next) {
  console.log('Request URL:', req.originalUrl);
  next();
}, function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});
</code>
</pre>
    <p>
      Route handlery dovoľujú definovať viacero route-ov pre jednu cestu.
      Nasledujúci príklad definuje dva routy pre GET requesty na ceste
      <code>/user/:id</code>. Definovanie druhého route nespôsobí žiadne
      problémy, ale ani sa nikdy nezavolá, pretože prvý route ukončí
      request-response cyklus.
    </p>
    <p>
      Tento príklad zobrazuje middleware sub-stack ktorý handluje GET requesty
      na ceste <code>/user/:id</code>.
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  console.log('ID:', req.params.id);
  next();
}, function (req, res, next) {
  res.send('User Info');
});

// handler for the /user/:id path, which prints the user ID
app.get('/user/:id', function (req, res, next) {
  res.end(req.params.id);
});
</code>
</pre>
    <p>
      Ak chcete preskočiť zostávajúce middleware funkcie z router middleware
      stack-u, zavolajte <code>next('route')</code> čím posuniete obsluhu
      ďalšiemu route. <strong>POZNÁMKA</strong>:
      <code>next('route')</code> zafunguje iba v takých middleware funkciách,
      ktoré boli načítané pomocou <code>app.METHOD()</code> alebo
      <code>router.METHOD()</code> funkcií.
    </p>
    <p>
      Tento príklad zobrazuje middleware sub-stack, ktorý handluje GET requesty
      na ceste <code>/user/:id</code>.
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.get('/user/:id', function (req, res, next) {
  // if the user ID is 0, skip to the next route
  if (req.params.id == 0) next('route');
  // otherwise pass the control to the next middleware function in this stack
  else next(); //
}, function (req, res, next) {
  // render a regular page
  res.render('regular');
});

// handler for the /user/:id path, which renders a special page
app.get('/user/:id', function (req, res, next) {
  res.render('special');
});
</code>
</pre>
    <h2 id="middleware.router">Router-level middleware</h2>
    <p>
      Router-level middleware funguje rovnakým spôsobom ako application-level
      middleware, avšak je pripojený k <code>express.Router()</code> inštancii.
    </p>
    <pre>
<code class="language-javascript" translate="no">
var router = express.Router();
</code>
</pre>
    <p>
      Router-level middleware načítate pomocou <code>router.use()</code> a
      <code>router.METHOD()</code> funkcií.
    </p>
    <p>
      Nasledujúci príklad replikuje vyššie zobrazený application-level
      middleware použitím router-level middlewaru:
    </p>
    <pre>
<code class="language-javascript" translate="no">
var app = express();
var router = express.Router();

// a middleware function with no mount path. This code is executed for every request to the router
router.use(function (req, res, next) {
  console.log('Time:', Date.now());
  next();
});

// a middleware sub-stack shows request info for any type of HTTP request to the /user/:id path
router.use('/user/:id', function(req, res, next) {
  console.log('Request URL:', req.originalUrl);
  next();
}, function (req, res, next) {
  console.log('Request Type:', req.method);
  next();
});

// a middleware sub-stack that handles GET requests to the /user/:id path
router.get('/user/:id', function (req, res, next) {
  // if the user ID is 0, skip to the next router
  if (req.params.id == 0) next('route');
  // otherwise pass control to the next middleware function in this stack
  else next(); //
}, function (req, res, next) {
  // render a regular page
  res.render('regular');
});

// handler for the /user/:id path, which renders a special page
router.get('/user/:id', function (req, res, next) {
  console.log(req.params.id);
  res.render('special');
});

// mount the router on the app
app.use('/', router);
</code>
</pre>
    <h2 id="middleware.error-handling">Error-handling middleware</h2>
    <div class="doc-box doc-notice" data-markdown="1">
      <p>
        Error-handling middleware príjma vždy <em>štyri</em> argumenty. Aby bolo
        možné identifikovať error-handling middleware funkciu, musíte jej
        definovať vždy štyri argumenty. Musíte ho definovať aj v situácii, kedy
        nepotrebujete použiť <code>next</code> objekt, aby ste dodržali
        dohodnutú signatúru. V opačnom prípade bude <code>next</code> objekt
        interpretovaný ako bežný middleware, ktorý nedokáže handlovať errory.
      </p>
    </div>
    <p>
      Error-handling middleware funkcie sa definujú rovnako ako ostatné
      middleware funkcie, len majú štyri argumenty namiesto troch, špecificky
      podľa signatúry <code>(err, req, res, next)</code>:
    </p>
    <pre>
<code class="language-javascript" translate="no">
app.use(function(err, req, res, next) {
  console.error(err.stack);
  res.status(500).send('Something broke!');
});
</code>
</pre>
    <p>
      Pre viac informácií ohľadom error-handling middlewarov si pozrite sekciu:
      <a href="/%7B%7B%20page.lang%20%7D%7D/guide/error-handling.html"
        >Error handling</a
      >.
    </p>
    <h2 id="middleware.built-in">Built-in middleware</h2>
    <p>
      Express počnúc od verzie 4.x nie je závislý na
      <a href="https://github.com/senchalabs/connect">Connect</a> module. Okrem
      výnimky <code>express.static</code>, všetky predošlé middleware funkcie
      pôvodne obsiahnuté v Express sú teraz samostatné moduly. Zoznam middleware
      funkcií
      <a href="https://github.com/senchalabs/connect#middleware"
        >si pozrite tu</a
      >.
    </p>
    <p>
      Jediným vstavaným middlewarom v Express je
      <code>express.static</code> funkcia. Tento middleware je založený na
      <a href="https://github.com/expressjs/serve-static">serve-static</a>
      module a je zodpovedný za servovanie statických assetov ako HTML súbory,
      obráky atď.
    </p>
    <p>Signatúra tejto funkcie je:</p>
    <pre>
<code class="language-javascript" translate="no">
express.static(root, [options])
</code>
</pre>
    <p>
      Parameter <code>root</code> špecifikuje hlavný adresár z ktorého bude
      statický obsah servovaný.
    </p>
    <p>
      Informácie ohľadom <code>options</code> parametra ako i ďalšie detaily
      ohľadom tohto middleware nájdete tu:
      <a href="/sk/4x/api.html#express.static">express.static</a>.
    </p>
    <p>
      Tu je príklad použitia <code>express.static</code> middleware funkcie s
      rôznou konfiguráciou options objektu:
    </p>
    <pre>
<code class="language-javascript" translate="no">
var options = {
  dotfiles: 'ignore',
  etag: false,
  extensions: ['htm', 'html'],
  index: false,
  maxAge: '1d',
  redirect: false,
  setHeaders: function (res, path, stat) {
    res.set('x-timestamp', Date.now());
  }
}

app.use(express.static('public', options));
</code>
</pre>
    <p>Môžete nastaviť aj viac ako jeden priečinok so statickým obsahom:</p>
    <pre>
<code class="language-javascript" translate="no">
app.use(express.static('public'));
app.use(express.static('uploads'));
app.use(express.static('files'));
</code>
</pre>
    <p>
      Pre viac detailov ohľadom <code>serve-static</code> funkcie a jej
      možnostiach si pozrite dokumentáciu k
      <a href="https://github.com/expressjs/serve-static">serve-static</a>
      modulu.
    </p>
    <h2 id="middleware.third-party">Third-party middleware</h2>
    <p>
      V Express aplikácii možete využiť taktiež third-party middleware
      funkcionalitu.
    </p>
    <p>
      Nainštalujte požadovaný Node.js modul a načítajte ho do aplikácie ako
      aplikačný, či router middleware.
    </p>
    <p>
      Nasledujúci príklad demonštruje inštaláciu a načítanie middleware funkcie
      <code>cookie-parser</code> slúžiacej na prácu s cookies.
    </p>
    <pre>
<code class="language-sh" translate="no">
$ npm install cookie-parser
</code>
</pre>
    <pre>
<code class="language-javascript" translate="no">
var express = require('express');
var app = express();
var cookieParser = require('cookie-parser');

// load the cookie-parsing middleware
app.use(cookieParser());
</code>
</pre>
    <p>
      Čiastočný zoznam bežne používaných third-party middleware funkcií pre
      Express nájdete v sekcii:
      <a href="../resources/middleware.html">Third-party middleware</a>.
    </p>
  </body>
</html>
