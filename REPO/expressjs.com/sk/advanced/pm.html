<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="sk" xml:lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Použitie správcov procesov pre Express aplikácie</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Použitie správcov procesov pre Express aplikácie</h1>
</header>
<!---
 Copyright (c) 2016 StrongLoop, IBM, and Express Contributors
 License: MIT
-->
<h1 id="použitie-správcov-procesov-pre-express-aplikácie">Použitie správcov procesov pre Express aplikácie</h1>
<p>Ak vaša Express aplikácia pobeží v produkcii, môže byť k dosiahnutiu nasledujúcich úloh vhodné použiť <em>správcu processov (process manager)</em>:</p>
<ul>
<li>Reštart aplikácie v prípade pádu.</li>
<li>Získanie prehľadu o spotrebe zdrojov a výkonnosti aplikácie.</li>
<li>Dynamická zmena nastavení k zlepšeniu výkonnosti.</li>
<li>Kontrola nad clustering-om.</li>
</ul>
<p>Správca procesov je čiastočne akoby aplikačný server: je to “kontainer” pre aplikácie uľahčujúci ich deployment, poskytujúci vysokú dostupnosť a umožňujúci správu aplikácie v runtime.</p>
<p>Najpopulárnejšie s pomedzi správcov procesov pre Express i ostatné Node.js aplikácie patria:</p>
<ul>
<li><a href="#sl">StrongLoop Process Manager</a></li>
<li><a href="#pm2">PM2</a></li>
<li><a href="#forever">Forever</a></li>
</ul>
<p>Použitie ktoréhokoľvek z hore spomenutých nástrojov môže byť veľmi nápomocné, avšak StrongLoop Process Manager je jediným nástrojom poskytujúcim obsiahle runtime a deployment riešenie adresujúce celý životný cyklus Node.js aplikácie pomocou nástrojov pre každý krok pred a po nasadení do produkcie a to v jednotnom rozhraní.</p>
<p>Tu je jednoduchý náhľad na každý z týchto nástrojov. Pre detailnejšie porovnanie sa pozrite na <a href="http://strong-pm.io/compare/">http://strong-pm.io/compare/</a>.</p>
<h2 id="strongloop-process-manager"><a id="sl">StrongLoop Process Manager</a></h2>
<p>StrongLoop Process Manager (StrongLoop PM) je produkčný správca procesov pre Node.js aplikácie. StrongLoop PM má vstavaný load balancing, monitoring, multi-host deployment a grafickú konzolu. StrongLoop PM môžete využiť na tieto úlohy:</p>
<ul>
<li>Build, package, a deploy vašej Node.js aplikácie na lokálny alebo remote systém.</li>
<li>Zobrazenie CPU profilov and heap snapshotov pre optimalizáciu výkonnosti a diagnostiku memory leakov.</li>
<li>Udržovanie procesov a clusterov vždy nažive.</li>
<li>Zobrazenie výkonnostných metrík vašej aplikácie.</li>
<li>Jednoduchá správa multi-host deploymentov s Nginx integráciou.</li>
<li>Unifikácia viacerých StrongLoop PM do distribuovaného runtime-u mikro servisov spravovateľných pomocou Arc.</li>
</ul>
<p>So StrongLoop PM dokážete pracovať pomocou výkonného command-line interface nástroja nazývaného <code>slc</code>, prípadne grafického nástroja nazývaného Arc. Arc je open source s profesonálnou podporou od StrongLoop-u.</p>
<p>Pre viac informácií si pozrite <a href="http://strong-pm.io/">http://strong-pm.io/</a>.</p>
<p>Celá dokumentácia:</p>
<ul>
<li><a href="http://docs.strongloop.com/display/SLC">Operating Node apps (StrongLoop documentation)</a></li>
<li><a href="http://docs.strongloop.com/display/SLC/Using+Process+Manager">Using StrongLoop Process Manager</a>.</li>
</ul>
<h3 id="inštalácia">Inštalácia</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install -g strongloop
</code>
</pre>
<h3 id="základné-použitie">Základné použitie</h3>
<pre>
<code class="language-sh" translate="no">
$ cd my-app
$ slc start
</code>
</pre>
<p>Zobrazenie stavu správcu procesov a všetkých deploynutých aplikácií:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl
Service ID: 1
Service Name: my-app
Environment variables:
  No environment variables defined
Instances:
    Version  Agent version  Cluster size
     4.1.13      1.5.14           4
Processes:
        ID      PID   WID  Listening Ports  Tracking objects?  CPU profiling?
    1.1.57692  57692   0
    1.1.57693  57693   1     0.0.0.0:3001
    1.1.57694  57694   2     0.0.0.0:3001
    1.1.57695  57695   3     0.0.0.0:3001
    1.1.57696  57696   4     0.0.0.0:3001
</code>
</pre>
<p>Vypísanie zoznamu všetkých aplikácií (servisov) pod správou:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl ls
Id          Name         Scale
 1          my-app       1
</code>
</pre>
<p>Stopnutie aplikácie:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl stop my-app
</code>
</pre>
<p>Reštart aplikácie:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl restart my-app
</code>
</pre>
<p>Môžete taktiež vykonať “mäkký reštart”, ktorý dá worker procesom dostatok času na uzatvorenie existujúcich pripojení a následne reštartuje aplikáciu:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl soft-restart my-app
</code>
</pre>
<p>Odstránenie aplikácie zo správy:</p>
<pre>
<code class="language-sh" translate="no">
$ slc ctl remove my-app
</code>
</pre>
<h2 id="pm2"><a id="pm2">PM2</a></h2>
<p>PM2 je produkčný správca procesov pre Node.js aplikácie so vstavaným load balancerom. PM2 dokáže udržať aplikáciu nažive a vykonať jej prípadný reload bez výpadku a umožní vykonávať bežné system admin úlohy. PM2 taktiež umožňuje spravovať logovanie, monitoring a clustering aplikácií.</p>
<p>Pre viac informácií sa pozrite na <a href="https://github.com/Unitech/pm2">https://github.com/Unitech/pm2</a>.</p>
<h3 id="inštalácia-1">Inštalácia</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install pm2 -g
</code>
</pre>
<h3 id="základné-použitie-1">Základné použitie</h3>
<p>Pre naštartovanie aplikácie pomocou <code>pm2</code> príkazu musíte špecifikovať cestu k aplikácii. Avšak pre stop, reštart, alebo odstránenie aplikácie zo správy, postačuje špecifikovať len jej názov alebo ID.</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 start npm --name my-app -- start
[PM2] restartProcessId process id 0
┌──────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────────────┬──────────┐
│ App name │ id │ mode │ pid   │ status │ restart │ uptime │ memory      │ watching │
├──────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────────────┼──────────┤
│ my-app   │ 0  │ fork │ 64029 │ online │ 1       │ 0s     │ 17.816 MB   │ disabled │
└──────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────────────┴──────────┘
 Use the `pm2 show <id|name>` command to get more details about an app.
</code>
</pre>
<p>Po naštartovaní aplikácie pomocou <code>pm2</code> príkazu sa aplikácia automaticky spustí na backgrounde (pozadí). Background aplikáciu môžete ovládať z príkazového riadka pomocou rozličných <code>pm2</code> príkazov.</p>
<p>Potom, ako je aplikácia naštartovaná pomocou <code>pm2</code> príkazu, je zaregistrovaná do zoznamu PM2 procesov pod konkrétnym ID. Preto dokážete spravovať aplikácie s rovnakým názvom z rôznych priečinkov, použitím ich ID.</p>
<p>Pozn., ak Vám beží viac ako jedna aplikácia s rovnakým názvom, vykonanie <code>pm2</code> príkazu ich ovplyvní všetky. Preto pre správu konkrétnej aplikácie používajte namiesto názvu radšej jej ID.</p>
<p>Vypísanie zoznamu všetkých bežiacich procesov:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 list
</code>
</pre>
<p>Stopnutie aplikácie:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 stop 0
</code>
</pre>
<p>Reštart aplikácie:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 restart 0
</code>
</pre>
<p>Pre zobrazenie detailných informácií o aplikácii:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 show 0
</code>
</pre>
<p>Odstránenie aplikácie z PM2 registra:</p>
<pre>
<code class="language-sh" translate="no">
$ pm2 delete 0
</code>
</pre>
<h2 id="forever"><a id="forever">Forever</a></h2>
<p>Forever je jednoduchý command-line nástroj slúžiaci na udržanie vášho skriptu nažive. Jednoduché rozhranie nástroja Forever ho robí ideálnym pre správu menších deploymentov Node.js aplikácií a skriptov.</p>
<p>Pre viac informácií sa pozrite na <a href="https://github.com/foreverjs/forever">https://github.com/foreverjs/forever</a>.</p>
<h3 id="inštalácia-2">Inštalácia</h3>
<pre>
<code class="language-sh" translate="no">
$ [sudo] npm install forever -g
</code>
</pre>
<h3 id="základné-použitie-2">Základné použitie</h3>
<p>Pre naštartovanie použite príkaz <code>forever start</code> a špecifikujte cestu k skriptu:</p>
<pre>
<code class="language-sh" translate="no">
$ forever start script.js
</code>
</pre>
<p>Tento príkaz spustí skript v tzv. daemon móde (na pozadí).</p>
<p>Pre priame spistenie skriptu v termináli vynechajte <code>start</code>:</p>
<pre>
<code class="language-sh" translate="no">
$ forever script.js
</code>
</pre>
<p>Je dobrým zvykom logovať výstup z nástroja Forever a skriptu pomocou prepínača <code>-l</code>, <code>-o</code> a <code>-e</code>, ako je uvedené v príklade nižšie:</p>
<pre>
<code class="language-sh" translate="no">
$ forever start -l forever.log -o out.log -e err.log script.js
</code>
</pre>
<p>Pre zobrazenie zoznamu skriptov, ktoré boli naštartované pomocou Forever použite:</p>
<pre>
<code class="language-sh" translate="no">
$ forever list
</code>
</pre>
<p>Pre stopnutie skriptu naštartovaného pomocou Forever použite príkaz <code>forever stop</code> a špecifikujte index procesu (podľa výpisu z <code>forever list</code> príkazu).</p>
<pre>
<code class="language-sh" translate="no">
$ forever stop 1
</code>
</pre>
<p>Taktiež to môžete vykonať pomocou špecifikovania cesty k skriptu:</p>
<pre>
<code class="language-sh" translate="no">
$ forever stop script.js
</code>
</pre>
<p>Pre stopnutie všetkých skriptov, ktoré boli naštartované pomocou Forever príkazu použite:</p>
<pre>
<code class="language-sh" translate="no">
$ forever stopall
</code>
</pre>
<p>Nástroj Forever má veľa možností a taktiež poskytuje programové API.</p>
</body>
</html>
