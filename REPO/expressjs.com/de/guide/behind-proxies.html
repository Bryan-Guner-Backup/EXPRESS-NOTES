<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Express hinter Proxys</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Express hinter Proxys</h1>
</header>
<h1 id="express-hinter-proxys">Express hinter Proxys</h1>
<p>Bei der Ausführung einer Express-Anwendung hinter einem Proxy legen Sie die Anwendungsvariable <code>trust proxy</code> (mithilfe von <a href="/%7B%7B%20page.lang%20%7D%7D/4x/api.html#app.set">app.set()</a>) auf einen der in der folgenden Tabelle enthaltenen Werte fest:</p>
<div class="doc-box doc-info" data-markdown="1">
<p>Auch wenn die Anwendungsausführung nicht fehlschlägt, wenn die Anwendungsvariable <code>trust proxy</code> nicht festgelegt wurde, wird die IP-Adresse des Proxys nicht ordnungsgemäß als Client-IP-Adresse eingetragen, es sei denn, <code>trust proxy</code> wurde konfiguriert.</p>
</div>
<table class="doctable" border="1" markdown="1">
<thead>
<tr>
<th>
Typ
</th>
<th>
Wert
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Boolesch
</td>
<td>
Wenn <code>true</code> angegeben wird, wird die IP-Adresse des Clients als der äußerst rechte Eintrag im Header <code>X-Forwarded-*</code> interpretiert. Wenn <code>false</code> angegeben wird, wird die Anwendung als direkte Verbindung zum Internet gesehen. Die IP-Adresse des Clients wird dann von <code>req.connection.remoteAddress</code> abgeleitet. Dies ist die Standardeinstellung.
</td>
</tr>
<tr>
<td>
IP-Adressen
</td>
<td>
<p>Eine einzelne IP-Adresse, ein Teilnetz oder ein Array von IP-Adressen und Teilnetzen, denen vertraut werden kann. Die folgende Liste zeigt die vorkonfigurierten Teilnetznamen: * loopback - <code>127.0.0.1/8</code>, <code>::1/128</code> * linklocal - <code>169.254.0.0/16</code>, <code>fe80::/10</code> * uniquelocal - <code>10.0.0.0/8</code>, <code>172.16.0.0/12</code>, <code>192.168.0.0/16</code>, <code>fc00::/7</code>.</p>
<p>Sie können IP-Adressen wie folgt festlegen:</p>
<pre>
<code class="language-js" translate="no">app.set('trust proxy', 'loopback') // specify a single subnet
app.set('trust proxy', 'loopback, 123.123.123.123') // specify a subnet and an address
app.set('trust proxy', 'loopback, linklocal, uniquelocal') // specify multiple subnets as CSV
app.set('trust proxy', ['loopback', 'linklocal', 'uniquelocal']) // specify multiple subnets as an array</code>
</pre>
Sobald die Werte angegeben wurden, werden die betreffenden IP-Adressen und Teilnetze aus dem Adressfeststellungsprozess ausgeschlossen. Die nicht vertrauenswürdige IP-Adresse, die am nächsten zum Anwendungsserver liegt, wird als IP-Adresse des Clients festgelegt.
</td>
</tr>
<tr>
<td>
Zahl
</td>
<td>
Dem <code>n</code>-ten Hop vom Proxy-Server soll als Client vertraut werden.
</td>
</tr>
<tr>
<td>
Funktion
</td>
<td>
Individuell angepasste, vertrauenswürdige Implementierung. Dies sollten Sie nur verwenden, wenn Sie genau wissen, was Sie tun.
<pre>
<code class="language-js" translate="no">app.set('trust proxy', function (ip) {
  if (ip === '127.0.0.1' || ip === '123.123.123.123') return true; // trusted IPs
  else return false;
});</code>
</pre>
</td>
</tr>
</tbody>
</table>
<p>Die Festlegung eines anderen <code>trust proxy</code>-Werts als <code>false</code> resultiert in drei wichtigen Änderungen:</p>
<ul>
<li>
Der Wert für <a href="/%7B%7B%20page.lang%20%7D%7D/api.html#req.hostname">req.hostname</a> wird vom Wert abgeleitet, der im Header <code>X-Forwarded-Host</code> festgelegt wurde. Dieser Wert kann vom Client oder Proxy festgelegt werden.
</li>
<li>
<code>X-Forwarded-Proto</code> kann vom Reverse Proxy festgelegt werden, um der Anwendung mitzuteilen, ob es sich um <code>https</code> oder <code>http</code> oder sogar um einen ungültigen Namen handelt. Dieser Wert wird durch <a href="/%7B%7B%20page.lang%20%7D%7D/api.html#req.protocol">req.protocol</a> abgebildet.
</li>
<li>
Als Werte für <a href="/%7B%7B%20page.lang%20%7D%7D/api.html#req.ip">req.ip</a> und <a href="/%7B%7B%20page.lang%20%7D%7D/api.html#req.ips">req.ips</a> wird die Liste der Adressen aus <code>X-Forwarded-For</code> herangezogen.
</li>
</ul>
<p>Die Einstellung für <code>trust proxy</code> wird mithilfe des <a href="https://www.npmjs.com/package/proxy-addr">proxy-addr</a>-Pakets implementiert. Weitere Informationen finden Sie in der zugehörigen Dokumentation.</p>
</body>
</html>
